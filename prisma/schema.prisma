// Models

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// MODELS

model Community {
  id                String            @id @default(auto()) @map("_id") @db.ObjectId
  guildId           String            @unique // guildId
  currencyname      String            @default("coin")
  ammount           Int               @default(100000)
  managers          Manager[] // _id (object_ids) of all managers
  taxPerTransaction Int               @default(0)
  CommunityMember   CommunityMember[]
  Transaction       Transaction[]
  RoleCommand       RoleCommand[]
}

// list of commands that a role can exicute
// might need to cache this for better performance in current style
// need to know more about how and where discordBot will decide to exicute this command
model RoleCommand {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  community    Community @relation(fields: [guildId], references: [guildId])
  guildId      String
  discordRoles String
  commands     String[]
}

model Manager {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  discordId      String
  community      Community @relation(fields: [guildId], references: [guildId])
  guildId        String
  communityRoles String[]
  managerRole    Roles     @default(MANAGER)
}

// NOTE:its not the discord role. that will be seperate
enum Roles {
  ADMIN // MANGER powers + Add more money to server change currency name and icon, add/remove managers
  MANAGER // can trnafer money to from users
}

model CommunityMember {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  discordId String
  community Community @relation(fields: [guildId], references: [guildId])
  guildId   String // i.e communitys guild id
  balance   Int       @default(0)
}

// TODO: from and to types might need to improve
model Transaction {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  community Community @relation(fields: [guildId], references: [guildId])
  guildId   String
  from      String
  to        String
  ammount   Int
}
